{
  "name": "Furniture Shop ‚Äî Orders Webhook",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "furniture-order",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "webhook-trigger",
      "name": "Webhook ‚Äî Order Received",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 300],
      "webhookId": "furniture-order"
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram\nconst order = $input.first().json.body;\n\nconst refLine = order.referral_code \n  ? `\\nüë§ <b>–ë–ª–æ–≥–µ—Ä:</b> ${order.referral_code}` \n  : '';\n\nconst tgUserLine = order.telegram_username \n  ? `\\nüí¨ Telegram: @${order.telegram_username}` \n  : (order.telegram_user_id ? `\\nüí¨ Telegram ID: ${order.telegram_user_id}` : '');\n\nconst colorLine = order.color \n  ? `\\nüé® –¶–≤–µ—Ç: ${order.color}` \n  : '';\n\nconst commentLine = order.comment \n  ? `\\nüìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${order.comment}` \n  : '';\n\nconst message = `üîî <b>–ù–û–í–´–ô –ó–ê–ö–ê–ó!</b>\\n\\n` +\n  `ü™ë <b>${order.product_name}</b>\\n` +\n  `${order.product_composition}${colorLine}\\n` +\n  `üí∞ <b>${Number(order.product_price).toLocaleString('ru-RU')} ‚ÇΩ</b>\\n\\n` +\n  `üë§ <b>–ö–ª–∏–µ–Ω—Ç:</b> ${order.customer_name}\\n` +\n  `üìû ${order.customer_phone}\\n` +\n  `üèô ${order.customer_city}` +\n  tgUserLine +\n  commentLine +\n  refLine +\n  `\\n\\n‚è∞ ${new Date(order.timestamp).toLocaleString('ru-RU')}`;\n\nreturn [{ json: { message, order } }];"
      },
      "id": "format-message",
      "name": "Format Telegram Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [480, 300]
    },
    {
      "parameters": {
        "chatId": "=1376926458",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "send-telegram",
      "name": "Send to Owner Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [720, 300],
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Furniture Shop Bot"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: true, message: 'Order received' }) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type"
              }
            ]
          }
        }
      },
      "id": "respond-success",
      "name": "Respond OK",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [960, 300]
    }
  ],
  "connections": {
    "Webhook ‚Äî Order Received": {
      "main": [
        [
          {
            "node": "Format Telegram Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Telegram Message": {
      "main": [
        [
          {
            "node": "Send to Owner Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to Owner Telegram": {
      "main": [
        [
          {
            "node": "Respond OK",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true
  }
}
